<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talking 3D Human with Three.js</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        #talkButton {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            z-index: 100;
        }

        #talkButton:active {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

    <button id="talkButton">Talk to Me</button>

    <!-- Include the Three.js library from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Include GLTFLoader to load 3D models -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        let scene, camera, renderer, humanModel, mixer, mouthBone;

        // Initialize Three.js Scene
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Add lighting
            const light = new THREE.DirectionalLight(0xffffff, 1);
            light.position.set(0, 1, 1).normalize();
            scene.add(light);

            // Load the GLTF human model (you can replace this URL with your own model)
            const loader = new THREE.GLTFLoader();
            loader.load('https://threejs.org/examples/models/gltf/RobotExpressive/RobotExpressive.glb', function (gltf) {
                humanModel = gltf.scene;
                scene.add(humanModel);

                // Move camera to a reasonable position
                camera.position.set(0, 1.5, 3);

                // Find the mouth bone in the model for mouth animation (you might need to adjust based on your model)
                mouthBone = humanModel.getObjectByName('Head_2'); // Replace 'Head_2' with the actual bone name for the mouth in your model

                // Render the scene
                animate();
            });
        }

        // Animate the scene
        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        // Simulate talking by scaling or rotating the mouth/jaw bone
        function startTalking() {
            if (mouthBone) {
                mouthBone.scale.y = 1.2;  // Simulate mouth opening
            }
        }

        function stopTalking() {
            if (mouthBone) {
                mouthBone.scale.y = 1;  // Reset mouth to normal
            }
        }

        // Speech Recognition and Synthesis
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        const synth = window.speechSynthesis;

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            synth.speak(utterance);

            startTalking();
            utterance.onend = stopTalking;
        }

        // Handle the Talk Button
        document.getElementById('talkButton').addEventListener('click', () => {
            recognition.start();
        });

        recognition.onresult = function(event) {
            const speechToText = event.results[0][0].transcript;
            console.log('You said:', speechToText);
            speak(speechToText); // Repeat the spoken words
        };

        recognition.onerror = function(event) {
            console.error(event.error);
            speak('Sorry, I did not understand. Please try again.');
        };

        // Initialize the scene
        init();

        // Handle resizing
        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

</body>
</html>
